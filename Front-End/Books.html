<!DOCTYPE html>


<html style="height:100%;">

<head>
    <meta charset="utf-8">
    <title> Study Buddy|Books </title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/style.css">


</head>
<body>

    <header id="head2">
        <div class="container">
            <div id="branding">
                <h1>
                    Books
                </h1>
            </div>
            <nav>
                <a href="InsertBook.html">LEND BOOKS</a>
                <a href="Home.html">HOME</a>

                <a href="new 4.html">ABOUT US </a>
            </nav>

        </div>
      
        <form name="sform" id="sform">
            BookTitle:
             <input type="text" name="title" id="title">

             BookAuthor:
             <input type="text" name="author" id="author">

             BookCode:
             <select name="code" id="code"   style="font-size:15px">
                <option value="MTH">MTH</option>
                <option value="CMP">CMP</option>
                <option value="STR">STR</option>
                <option value="EEE">EEE</option>
                <option value="AET">AET</option>
                <option value="MDE">MDE</option>
                <option value="STE">STE</option>
                <option value="CEM">CEM</option>
            </select> 
                <input name="search" id ="search" type="submit" value="search">
         </form>
    </header>
    <div id="main">
         <table id="tab"  cellspacing="20px" style="margin:10px">
                <thead>
                    <th>BookTitle</th>
                    <th>BookAuthor</th>
                    <th>BookEdition</th>
                    <th>BookStatus</th>
                </thead>
                <tbody> 
        
        
                </tbody>
            </table>

    </div>
    
   

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script> 
    
    
    function myFunction(x){
               alert("row");
           }
         $(document).ready(function(ev){
           

            $.ajax({
           
           type:"GET", 
           url :'http://localhost:3000/api/Book', 
           headers: {
                        "x-access-token": localStorage.getItem('token')
                    },
           success:function(response){
               console.log(response);
               if (!(response.Error)){
               var tablehtml="";
               // arrays to store book doner, book_id,book_code
               var doner=[];
               var bookid=[];
               var bookcode=[];
               // filling the arrays with data
               for (i=0;i<response.Books.length;i++){
                   doner[i]=response.Books[i].doner_ID;
                   bookid[i]=response.Books[i].book_id;
                   bookcode[i]=response.Books[i].book_code;

               }
               //filling the table (tab)
               for (var key in response.Books){
                   if(response.Books.hasOwnProperty(key)){
                       tablehtml += "<tr>" 
                        tablehtml += "<td>" + response.Books[key]["book_title"] + "</td>";
                        tablehtml += "<td>" + response.Books[key]["book_author"] + "</td>";
                        tablehtml += "<td>" + response.Books[key]["book_edition"] + "</td>";
                        tablehtml += "<td>" + response.Books[key]["book_status"] + "</td>";
                        tablehtml += "</tr>";
                   }
                }
            }

             $("#tab tbody").html(tablehtml); //this line adds the table created (tablehtml) in the tbody section of the body
         var tables=document.getElementById("tab"); 
         //these lines responsible for detecting the row clicked
        for(i=1;i<tables.rows.length;i++){
             var r=tables.rows[i];
              r.onclick =function(){
                if(!this.hilite){ //to highlight the selected row
                this.origColor=this.style.backgroundColor;
                this.style.backgroundColor='#BCD4EC';
                this.hilite = true;
                 }
    
                  var ind=this.rowIndex;
                  // get the data stored in the cells of the selected row
                  var booktitle=this.getElementsByTagName("td")[0]; 
                  var bookauthor=this.getElementsByTagName("td")[1];
                  var bookedition=this.getElementsByTagName("td")[2];
                  //console.log(booktitle.innerHTML, bookauthor.innerHTML,bookedition.innerHTML,doner[ind-1],bookid[ind-1],bookcode[ind-1]);
                  // responsible for showing the message to ask the user if he was sure to add the book
                  if (confirm("are you sure you want to add this book to the cart? \n"+'"'+booktitle.innerHTML+'"'+" by "+'"'+bookauthor.innerHTML+'"'+" "+bookedition.innerHTML+" edition for "+bookcode[ind-1])){
                      alert("the book was added to cart"); 
                      // what would happen if the user clicks ok (he wants to add the book)
                     var book={
                         book_title: booktitle.innerHTML,
                         book_author: bookauthor.innerHTML,
                         book_edition: bookedition.innerHTML
                     }
                    // console.log(book);
                  }
                  // remove the highlight of the row
                  this.style.backgroundColor=this.origColor;
                     this.hilite = false;
              }
            
           
             };
            
              
           },
           error: function(){
               console.log("Error in connection");
           },
         
          
       });

         })
       
        
       
                                  
            
           $('#search').on('click',function(ev){
            ev.preventDefault();

            
                             
        $.ajax({
           
           type:"POST", 
           url :'http://localhost:3000/api/searchBook',
           data: $('#sform').serialize(), 
           headers: {
                        "x-access-token": localStorage.getItem('token')
                    },
           success:function(response){
               
               console.log(response);
               if(!(response.Error)){
                var a;
                var b;
                var c;
                var d;
                document.getElementById("tab").innerHTML=" <tr><th>BookTitle</th><th>BookAuthor</th><th>BookEdition</th><th>BookStatus</th></tr>";
                for(i=0;i<response.n;i++){

                    var table=document.getElementsByTagName("table") [0];
                   
                    var newrow=table.insertRow(i+1);

                    var cel1=newrow.insertCell(0);
                    var cel2=newrow.insertCell(1);
                    var cel3=newrow.insertCell(2);
                    var cel4=newrow.insertCell(3);

                    a= response.Books[i].book_title; 
                    b= response.Books[i].book_author;
                    c= response.Books[i].book_edition;
                    d=response.Books[i].book_status;

                    cel1.innerText=a;
                    cel2.innerText=b;
                    cel3.innerText=c;
                    cel4.innerText=d;   
                }               
           }
              
           },
           error: function(){
               console.log("Error in connection");
           },
         
          
       });
           }
        
    )
    

    </script>

</body>
</html>
